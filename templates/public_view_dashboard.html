<!DOCTYPE html>
<html lang="ro" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vizualizare Publică - {{ report_title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            background-color: #212529;
            color: #dee2e6;
        }
        .card {
            background-color: #343a40;
            border-color: #495057;
        }
        .table {
            --bs-table-bg: #343a40;
            --bs-table-striped-bg: #3c4248;
            --bs-table-color: #dee2e6;
            --bs-table-border-color: #495057;
        }
        .list-group-item {
            background-color: #343a40;
            border-color: #495057;
        }
    </style>
</head>
<body>
    <div class="container my-4">
        <div class="text-center mb-4">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="width: 80px; height: 80px; margin-bottom: 1rem;">
            <h1 class="display-5">{{ report_title }}</h1>
            <p class="lead">Raport de Situație Read-Only</p>
            <p class="text-muted small">
                Generat la: {{ generated_at | localdatetime }} | Token valabil până la: {% if token.expires_at %}{{ token.expires_at | localdatetime }}{% else %}Nespecificat{% endif %}
            </p>
        </div>

        <!-- Dashboard Summary -->
        <div class="row text-center mb-4">
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Efectiv Control</h5>
                        <p class="card-text fs-2 fw-bold">{{ situation_now.efectiv_control }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Efectiv Prezent (Acum)</h5>
                        <p class="card-text fs-2 fw-bold text-success">{{ situation_now.efectiv_prezent_total }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Efectiv Absent (Acum)</h5>
                        <p class="card-text fs-2 fw-bold text-danger">{{ situation_now.efectiv_absent_total }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Situation -->
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Situație Detaliată (la {{ situation_now.datetime_checked | localdatetime }})</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <h5>Prezenți ({{ situation_now.efectiv_prezent_total }})</h5>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                În Formație
                                <span class="badge bg-primary rounded-pill">{{ situation_now.in_formation_count }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                La Servicii
                                <span class="badge bg-primary rounded-pill">{{ situation_now.on_duty_count }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Gradați Pluton Prezenți
                                <span class="badge bg-primary rounded-pill">{{ situation_now.platoon_graded_duty_count }}</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-lg-6 mt-4 mt-lg-0">
                        <h5>Absenți ({{ situation_now.efectiv_absent_total }})</h5>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                În Permisie / Învoire
                                <span class="badge bg-warning rounded-pill">{{ situation_now.absent_students_details | length }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Scutire Medicală Totală (SMT)
                                <span class="badge bg-danger rounded-pill">{{ situation_now.smt_count }}</span>
                            </li>
                             <li class="list-group-item d-flex justify-content-between align-items-center">
                                Alte Scutiri Medicale
                                <span class="badge bg-secondary rounded-pill">{{ situation_now.exempt_other_count }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Lists -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="accordion" id="detailsAccordion">

                    {% macro student_list_accordion(id, title, students, badge_class='bg-secondary') %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading-{{ id }}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ id }}" aria-expanded="false" aria-controls="collapse-{{ id }}">
                                {{ title }}
                                <span class="badge {{ badge_class }} ms-2">{{ students|length }}</span>
                            </button>
                        </h2>
                        <div id="collapse-{{ id }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ id }}" data-bs-parent="#detailsAccordion">
                            <div class="accordion-body">
                                {% if students %}
                                    <ul class="list-group">
                                        {% for student_detail in students %}
                                            <li class="list-group-item">{{ student_detail }}</li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="text-muted">Niciun student în această categorie.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endmacro %}

                    {{ student_list_accordion('on_duty', 'Studenți la Servicii', situation_now.on_duty_students_details, 'bg-info') }}
                    {{ student_list_accordion('on_leave', 'Studenți în Permisie / Învoire', situation_now.absent_students_details, 'bg-warning') }}
                    {{ student_list_accordion('smt', 'Studenți cu SMT', situation_now.smt_students_details, 'bg-danger') }}
                    {{ student_list_accordion('exempt_other', 'Studenți cu Alte Scutiri', situation_now.exempt_other_students_details, 'bg-secondary') }}
                    {{ student_list_accordion('platoon_graded', 'Situație Gradați Pluton', situation_now.platoon_graded_duty_students_details, 'bg-primary') }}

                </div>
            </div>
        </div>

    </div>

    <footer class="text-center text-muted small py-4">
        <p>&copy; {{ get_localized_now().year }} - Sistem de Management Studenți. Toate drepturile rezervate.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
