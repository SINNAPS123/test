{% extends "base.html" %}
{% block title %}Insights - {{ scope_label }}{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h3 class="mb-0">Insights - {{ scope_label }}</h3>
  <div class="d-flex gap-2">
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-sm">Înapoi</a>
  </div>
</div>

<div class="row g-3 mb-3">
  <div class="col-sm-6 col-lg-3">
    <div class="stat-card p-3 border rounded text-center">
      <h4 class="mb-0">{{ stats.students_count if stats.students_count is defined else '—' }}</h4>
      <small class="text-muted">Studenți în scope</small>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="stat-card p-3 border rounded text-center">
      <h4 class="mb-0">{{ stats.permissions_active }}</h4>
      <small class="text-muted">Permisii active</small>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="stat-card p-3 border rounded text-center">
      <h4 class="mb-0">{{ stats.services_active }}</h4>
      <small class="text-muted">Servicii active</small>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="stat-card p-3 border rounded text-center">
      <h4 class="mb-0">{{ stats.weekend_leaves_upcoming }}</h4>
      <small class="text-muted">Weekend leaves în 7 zile</small>
    </div>
  </div>
</div>

<div class="card mb-3">
  <div class="card-header"><i class="fas fa-calendar-alt me-2"></i>Evenimente următoare (7 zile)</div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover table-sm">
        <thead>
          <tr>
            <th>Tip</th>
            <th>Student</th>
            <th>Început</th>
            <th>Final</th>
            <th>Detalii</th>
          </tr>
        </thead>
        <tbody>
          {% for u in upcoming %}
          <tr data-reminder="true" data-start="{{ u.start.isoformat() }}" data-title="{{ u.kind }} - {{ u.student }} la {{ u.start|localdatetime('%H:%M') }}">
            <td>{{ u.kind }}</td>
            <td>{{ u.student }}</td>
            <td>{{ u.start|localdatetime('%d-%m-%Y %H:%M') }}</td>
            <td>{{ u.end|localdatetime('%d-%m-%Y %H:%M') }}</td>
            <td>{{ u.meta }}</td>
          </tr>
          {% else %}
          <tr><td colspan="5" class="text-center text-muted">Nu există evenimente în orizontul selectat.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="card-footer small text-muted">Hint: click pe header pentru sortare, Shift+F pentru filtru rapid.</div>
</div>

<div class="card mb-3">
  <div class="card-header"><i class="fas fa-exclamation-triangle me-2"></i>Conflicte/Suprapuneri</div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover table-sm">
        <thead>
          <tr>
            <th>Student</th>
            <th>Eveniment A</th>
            <th>Eveniment B</th>
            <th>Interval</th>
          </tr>
        </thead>
        <tbody>
          {% for c in conflicts %}
          <tr>
            <td>{{ c.student }}</td>
            <td>{{ c.a }}</td>
            <td>{{ c.b }}</td>
            <td>{{ c.start|localdatetime('%d-%m-%Y %H:%M') }} - {{ c.end|localdatetime('%d-%m-%Y %H:%M') }}</td>
          </tr>
          {% else %}
          <tr><td colspan="4" class="text-center text-muted">Nu s-au detectat conflicte.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

