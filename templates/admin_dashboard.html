{% extends "base.html" %}

{% block title %}Panou Admin{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Panou de Control Admin</h2>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Creare Utilizator Nou (Gradat/Comandant)</h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin_create_user') }}">
                        <div class="mb-3">
                            <label for="username" class="form-label">Nume utilizator:</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                            <small class="form-text text-muted">
                                Ex: <strong>Popescu_V</strong> (gradat),
                                <strong>CmdC1</strong> (Cmd. Compania 1),
                                <strong>CmdB1</strong> (Cmd. Batalionul 1).
                            </small>
                        </div>
                        <div class="mb-3">
                            <label for="role" class="form-label">Rol:</label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="" disabled selected>Selectează rolul</option>
                                <option value="gradat">Gradat (Comandant Pluton)</option>
                                <option value="comandant_companie">Comandant Companie</option>
                                <option value="comandant_batalion">Comandant Batalion</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success">Creare Utilizator și Generare Cod</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Informații Utile</h4>
                </div>
                <div class="card-body">
                    <p>Utilizatorii creați vor primi un <strong>cod unic</strong>. Ei trebuie să folosească acest cod la prima autentificare.</p>
                    <p>După prima autentificare cu codul unic, li se va cere să își seteze un <strong>cod personal</strong>.</p>
                    <p>Logările ulterioare se vor face folosind codul personal.</p>
                    <hr>
                    <h5>Statistici (placeholder)</h5>
                    <p>
                        Secțiunea pentru managementul "Gradaților Speciali" (Useri) a fost eliminată.
                        Noua funcționalitate de "Gradat Pluton" se va gestiona la nivel de Student.
                    </p>
                    <!-- Linkul către admin_manage_special_graded a fost eliminat -->
                </div>
            </div>
        </div>
    </div>

    <!-- Adăugat înainte de <hr class="my-4"> și "Listă Utilizatori" -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4>Funcționalități Administrative Suplimentare</h4>
                </div>
                <div class="card-body">
                    <a href="{{ url_for('admin_action_logs') }}" class="btn btn-info me-2">
                        <i class="fas fa-history"></i> Jurnal Acțiuni Sistem
                    </a>
                    <a href="{{ url_for('list_students') }}" class="btn btn-secondary me-2">
                        <i class="fas fa-users"></i> Listă Generală Studenți
                    </a>
                    <a href="{{ url_for('admin_list_permissions') }}" class="btn btn-secondary me-2">
                        <i class="fas fa-calendar-check"></i> Listă Generală Permisii
                    </a>
                    <a href="{{ url_for('admin_list_daily_leaves') }}" class="btn btn-secondary me-2">
                        <i class="fas fa-person-walking-arrow-right"></i> Listă Generală Învoiri Zilnice
                    </a>
                     <a href="{{ url_for('admin_list_weekend_leaves') }}" class="btn btn-secondary me-2">
                        <i class="fas fa-calendar-week"></i> Listă Generală Învoiri Weekend
                    </a>
                    <a href="{{ url_for('admin_list_services') }}" class="btn btn-secondary">
                        <i class="fas fa-clipboard-user"></i> Listă Generală Servicii
                    </a>
                    <!-- Alte link-uri admin pot fi adăugate aici -->
                </div>
            </div>
        </div>
    </div>

    <hr class="my-4">

    <h3 class="mb-3">Listă Utilizatori (Non-Admin)</h3>
    {% if users %}
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nume Utilizator</th>
                    <th>Rol</th>
                    <th>Cod Unic (la creare/reset)</th>
                    <th>Necesită Setare Cod Personal?</th>
                    <th>Acțiuni</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.role }}</td>
                    <td>
                        {% if user.unique_code %}
                            <span class="badge bg-info text-dark">{{ user.unique_code }}</span>
                        {% else %}
                            <span class="badge bg-secondary">N/A</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user.is_first_login %}
                            <span class="badge bg-warning text-dark">Da</span>
                        {% else %}
                            <span class="badge bg-success">Nu (Cod personal setat)</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if user.role != 'admin' %}
                        <form method="POST" action="{{ url_for('admin_reset_user_code', user_id=user.id) }}" class="d-inline me-1" onsubmit="return confirm('Ești sigur că vrei să resetezi codul pentru {{ user.username }}? Acest lucru va genera un nou cod unic și va necesita ca utilizatorul să își seteze un nou cod personal.');">
                            <button type="submit" class="btn btn-sm btn-warning">Resetare Cod</button>
                        </form>
                        <form method="POST" action="{{ url_for('admin_delete_user', user_id=user.id) }}" class="d-inline" onsubmit="return confirm('ATENȚIE! Ești sigur că vrei să ștergi utilizatorul {{ user.username }}? Dacă este gradat, TOȚI studenții și datele asociate acestuia (permisii, învoiri, servicii, etc.) vor fi ȘTERSE DEFINITIV. Această acțiune este ireversibilă!');">
                            <button type="submit" class="btn btn-sm btn-danger">Șterge Utilizator</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>Nu există alți utilizatori în sistem.</p>
    {% endif %}
</div>
{% endblock %}
