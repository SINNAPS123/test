{% extends "base.html" %}

{% block title %}Panou Comandant Companie {{ company_id }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-3">Panou Comandant Compania {{ company_id }}</h2>
    <p class="text-muted">Situația efectivelor pentru Apelul de Seară din {{ roll_call_time_str }}</p>
    <hr>

    {% if total_company_presence %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white" style="background-color: var(--accent-primary) !important;">
            <h4 class="mb-0">Efective Totale Compania {{ company_id }}</h4>
        </div>
        <div class="card-body">
            <p>
                <strong>Efectiv Control (EC):</strong> <span class="badge bg-dark fs-6">{{ total_company_presence.efectiv_control }}</span><br>
                <strong>Efectiv Prezent (Ep):</strong> <span class="badge bg-success fs-6">{{ total_company_presence.efectiv_prezent_total }}</span> (Formație: {{total_company_presence.in_formation_count}}, Serviciu: {{total_company_presence.on_duty_count}})<br>
                <strong>Efectiv Absent (Ea):</strong> <span class="badge bg-danger fs-6">{{ total_company_presence.efectiv_absent_total }}</span>
            </p>
            {% if total_company_presence.efectiv_absent_total > 0 and not platoons_data %}
                <p class="mb-1"><small><strong>Absenți din companie (detalii agregate):</strong></small></p>
                <ul class="list-unstyled" style="font-size: 0.9em;">
                    {% for absent_detail in total_company_presence.absent_students_details %}
                        <li><small>{{ absent_detail }}</small></li>
                    {% endfor %}
                </ul>
            {% elif total_company_presence.efectiv_absent_total == 0 and total_company_presence.efectiv_control > 0 %}
                 <p class="text-success mb-0"><small>Toți studenții din companie sunt prezenți sau în serviciu.</small></p>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning">Nu s-au putut încărca datele de prezență agregate pentru companie.</div>
    {% endif %}

    <h4 class="mt-4">Detalii Efective pe Plutoane:</h4>
    {% if platoons_data %}
        {% for platoon_name, data in platoons_data.items()|sort %}
        <div class="card shadow-sm mb-3">
            <div class="card-header">
                <h5 class="mb-0">{{ platoon_name }}</h5>
            </div>
            <div class="card-body">
                <p>
                    EC: <span class="badge bg-dark">{{ data.efectiv_control }}</span> |
                    Ep: <span class="badge bg-success">{{ data.efectiv_prezent_total }}</span> (Formație: {{data.in_formation_count}}, Serviciu: {{data.on_duty_count}}) |
                    Ea: <span class="badge bg-danger">{{ data.efectiv_absent_total }}</span>
                </p>
                {% if data.absent_students_details %}
                    <p class="mb-1"><small><strong>Absenți din {{ platoon_name }}:</strong></small></p>
                    <ul class="list-unstyled" style="font-size: 0.9em;">
                        {% for absent_detail in data.absent_students_details %}
                            <li><small>{{ absent_detail }}</small></li>
                        {% endfor %}
                    </ul>
                {% elif data.efectiv_absent_total == 0 and data.efectiv_control > 0 %}
                    <p class="text-success mb-0"><small>Toți studenții din {{ platoon_name }} sunt prezenți sau în serviciu.</small></p>
                {% elif data.efectiv_control == 0 %}
                     <p class="text-muted mb-0"><small>Nu există studenți înregistrați pentru {{ platoon_name }}.</small></p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info">Nu există plutoane cu studenți în această companie sau datele nu au putut fi încărcate.</div>
    {% endif %}

    {# Am eliminat secțiunea "Statistici Rapide" deocamdată #}

    <p class="mt-4">
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-sm">
            &laquo; Înapoi la Panoul Principal
        </a>
    </p>
</div>
{% endblock %}
