{% extends "base.html" %}

{% block title %}Profil Student: {{ student.nume }} {{ student.prenume }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Profile Header -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-user-circle fa-4x text-primary"></i>
                </div>
                <div class="flex-grow-1 ms-3">
                    <h2 class="mb-0">{{ student.grad_militar }} {{ student.nume }} {{ student.prenume }}</h2>
                    <p class="text-muted mb-1">
                        {{ student.batalion }} / {{ student.companie }} / {{ student.pluton }}
                    </p>
                    <div>
                        {% if student.is_platoon_graded_duty %}
                            <span class="badge bg-success">Gradat Pluton Propriu</span>
                        {% endif %}
                        {% if student.assigned_graded_platoon %}
                            <span class="badge bg-info">Gradat la Pl. {{ student.assigned_graded_platoon }}</span>
                        {% endif %}
                        {% if student.is_smt %}
                            <span class="badge bg-danger">SMT</span>
                        {% endif %}
                        {% if student.exemption_details %}
                            <span class="badge bg-warning text-dark">Scutire: {{ student.exemption_details }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="text-end">
                    <a href="{{ url_for('list_students') }}" class="btn btn-outline-secondary btn-sm mb-2">&laquo; Înapoi la Listă</a>
                    <p class="mb-0"><strong>Puncte Voluntariat:</strong> <span class="badge bg-primary fs-6">{{ student.volunteer_points }}</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs for Activities -->
    <ul class="nav nav-tabs" id="profileTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="permissions-tab" data-bs-toggle="tab" data-bs-target="#permissions" type="button" role="tab" aria-controls="permissions" aria-selected="true">Permisii</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="daily-leaves-tab" data-bs-toggle="tab" data-bs-target="#daily-leaves" type="button" role="tab" aria-controls="daily-leaves" aria-selected="false">Învoiri Zilnice</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="weekend-leaves-tab" data-bs-toggle="tab" data-bs-target="#weekend-leaves" type="button" role="tab" aria-controls="weekend-leaves" aria-selected="false">Învoiri Weekend</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab" aria-controls="services" aria-selected="false">Servicii</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="volunteering-tab" data-bs-toggle="tab" data-bs-target="#volunteering" type="button" role="tab" aria-controls="volunteering" aria-selected="false">Voluntariat</button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="profileTabContent">
        <!-- Permissions Tab -->
        <div class="tab-pane fade show active" id="permissions" role="tabpanel" aria-labelledby="permissions-tab">
            <div class="table-responsive mt-3">
                <table class="table table-sm table-striped">
                    <thead><tr><th>Start</th><th>Sfârșit</th><th>Destinație</th><th>Transport</th><th>Motiv</th><th>Status</th></tr></thead>
                    <tbody>
                        {% for p in permissions %}
                        <tr>
                            <td>{{ p.start_datetime | localdatetime }}</td>
                            <td>{{ p.end_datetime | localdatetime }}</td>
                            <td>{{ p.destination }}</td>
                            <td>{{ p.transport_mode }}</td>
                            <td>{{ p.reason }}</td>
                            <td><span class="badge {% if p.status == 'Aprobată' %}bg-success{% else %}bg-secondary{% endif %}">{{ p.status }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="6" class="text-center text-muted">Nicio permisie înregistrată.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Daily Leaves Tab -->
        <div class="tab-pane fade" id="daily-leaves" role="tabpanel" aria-labelledby="daily-leaves-tab">
            <div class="table-responsive mt-3">
                <table class="table table-sm table-striped">
                    <thead><tr><th>Data</th><th>Interval Orar</th><th>Tip</th><th>Motiv</th><th>Status</th></tr></thead>
                    <tbody>
                        {% for dl in daily_leaves %}
                        <tr>
                            <td>{{ dl.leave_date | localdate }}</td>
                            <td>{{ dl.start_time | localtime }} - {{ dl.end_time | localtime }}</td>
                            <td>{{ dl.leave_type_display }}</td>
                            <td>{{ dl.reason }}</td>
                            <td><span class="badge {% if dl.status == 'Aprobată' %}bg-success{% else %}bg-secondary{% endif %}">{{ dl.status }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center text-muted">Nicio învoire zilnică înregistrată.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Weekend Leaves Tab -->
        <div class="tab-pane fade" id="weekend-leaves" role="tabpanel" aria-labelledby="weekend-leaves-tab">
            <div class="table-responsive mt-3">
                <table class="table table-sm table-striped">
                    <thead><tr><th>Weekend Start</th><th>Intervale</th><th>Biserică</th><th>Motiv</th><th>Status</th></tr></thead>
                    <tbody>
                        {% for wl in weekend_leaves %}
                        <tr>
                            <td>{{ wl.weekend_start_date | localdate }}</td>
                            <td>{{ wl.display_days_and_times }}</td>
                            <td>{% if wl.duminica_biserica %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-times text-muted"></i>{% endif %}</td>
                            <td>{{ wl.reason }}</td>
                            <td><span class="badge {% if wl.status == 'Aprobată' %}bg-success{% else %}bg-secondary{% endif %}">{{ wl.status }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center text-muted">Nicio învoire de weekend înregistrată.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Services Tab -->
        <div class="tab-pane fade" id="services" role="tabpanel" aria-labelledby="services-tab">
            <div class="table-responsive mt-3">
                <table class="table table-sm table-striped">
                    <thead><tr><th>Tip Serviciu</th><th>Start</th><th>Sfârșit</th><th>Participă la Apel</th><th>Note</th></tr></thead>
                    <tbody>
                        {% for s in services %}
                        <tr>
                            <td>{{ s.service_type }}</td>
                            <td>{{ s.start_datetime | localdatetime }}</td>
                            <td>{{ s.end_datetime | localdatetime }}</td>
                            <td>{% if s.participates_in_roll_call %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-times text-danger"></i>{% endif %}</td>
                            <td>{{ s.notes }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center text-muted">Niciun serviciu înregistrat.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Volunteering Tab -->
        <div class="tab-pane fade" id="volunteering" role="tabpanel" aria-labelledby="volunteering-tab">
            <div class="table-responsive mt-3">
                <table class="table table-sm table-striped">
                    <thead><tr><th>Nume Activitate</th><th>Data Activității</th><th>Puncte Acordate</th></tr></thead>
                    <tbody>
                        {% for ap in participations %}
                        <tr>
                            <td>{{ ap.activity.name }}</td>
                            <td>{{ ap.activity.activity_date | localdate }}</td>
                            <td><span class="badge bg-primary">{{ ap.points_awarded }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="3" class="text-center text-muted">Nicio participare la voluntariat înregistrată.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
